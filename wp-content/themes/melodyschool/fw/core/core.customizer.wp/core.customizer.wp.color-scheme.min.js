(function(h){var j={},c=true;if(!melodyschool_customizer_vars.need_refresh){for(var g in melodyschool_color_schemes){j[g]=wp.template("melodyschool-color-scheme-"+g)}j.fonts=wp.template("melodyschool-fonts")}h.bind("ready",function(){if(melodyschool_customizer_vars.need_refresh){jQuery("#customize-header-actions .spinner").after('<input type="button" class="button customize-action-refresh" value="'+melodyschool_customizer_vars.msg_refresh+'">');jQuery("#customize-header-actions .customize-action-refresh").on("click",function(i){h.previewer.send("refresh-preview");setTimeout(function(){h.previewer.refresh()},500)})}jQuery("#customize-theme-controls .control-section").each(function(){a(jQuery(this))});f(h("color_scheme")())});h.bind("change",function(i){if(i.id=="scheme_storage"){return}a(jQuery("#customize-theme-controls #customize-control-"+i.id).parents(".control-section"));e(i)});function a(i){i.find(".customize-control").each(function(){var n=jQuery(this).attr("id");if(n==undefined){return}n=n.replace("customize-control-","");var m=false;for(var p in melodyschool_dependencies){if(p==n){m=melodyschool_dependencies[n];break}}if(m){var u=0,t=0;var r=typeof m.compare!="undefined"?m.compare.toLowerCase():"and";var v=typeof m.strict!="undefined";var p=null,o="";for(var s in m){if(s=="compare"||s=="strict"){continue}t++;p=i.find('[data-customize-setting-link="'+s+'"]');if(p.length>0){o=p.attr("type")=="checkbox"||p.attr("type")=="radio"?(p.parents(".customize-control").find("[data-customize-setting-link]:checked").length>0?p.parents(".customize-control").find("[data-customize-setting-link]:checked").val():0):p.val();if(o===undefined){o=""}for(var q in m[s]){if((m[s][q]=="not_empty"&&o!="")||(m[s][q]=="is_empty"&&o=="")||(o!==""&&(!isNaN(m[s][q])?o==m[s][q]:(v?o==m[s][q]:o.indexOf(m[s][q])==0)))||(o!=""&&m[s][q].charAt(0)=="^"&&o.indexOf(m[s][q].substr(1))==-1)){u++;break}}}else{t--}if(u>0&&r=="or"){break}}if((u>0&&r=="or")||(u==t&&r=="and")){jQuery(this).show().removeClass("melodyschool_options_no_use")}else{jQuery(this).hide().addClass("melodyschool_options_no_use")}}})}function e(n){if(n.transport!="postMessage"){return}var s=n.id,o=n();var r=false;if(s=="color_scheme"){f(o)}else{if(c){var q=h("color_settings")()=="simple";for(var m in melodyschool_color_schemes.original){if(m==s){c=false;d(m,o);if(q){if(s=="text_link"){h("alter_link").set(o);h.control("alter_link").container.find(".color-picker-hex").data("data-default-color",o).wpColorPicker("defaultColor",o);d("alter_link",o)}else{if(s=="text_hover"){h("alter_hover").set(o);h.control("alter_hover").container.find(".color-picker-hex").data("data-default-color",o).wpColorPicker("defaultColor",o);d("alter_hover",o)}}}c=true;r=true;break}}if(!r){for(var i in melodyschool_fonts){for(var p in melodyschool_fonts[i]){if(p=="title"||p=="description"){continue}if(i+"-"+p==s){r=true;b(i,p,o);break}}if(r){break}}}if(r){l()}}}if(!r){h.previewer.send("refresh-other-controls",{id:s,value:o})}}function d(i,m){melodyschool_color_schemes[h("color_scheme")()][i]=m;h("scheme_storage").set(melodyschool_serialize(melodyschool_color_schemes))}function f(m){c=false;for(var i in melodyschool_color_schemes[m]){if(h(i)==undefined){continue}h(i).set(melodyschool_color_schemes[m][i]);h.control(i).container.find(".color-picker-hex").data("data-default-color",melodyschool_color_schemes[m][i]).wpColorPicker("defaultColor",melodyschool_color_schemes[m][i])}c=true;l()}function b(i,n,m){melodyschool_fonts[i][n]=m}function l(){if(!c||melodyschool_customizer_vars.need_refresh){return}var r="";for(var p in melodyschool_color_schemes){var n=[];for(var q in melodyschool_color_schemes[p]){if(q=="title"){continue}n[q]=melodyschool_color_schemes[p][q]}if(window.melodyschool_customizer_wp_add_theme_colors){n=melodyschool_customizer_wp_add_theme_colors(n)}r+=j[p](n)}var s=[],o=[];for(var m in melodyschool_fonts){o=melodyschool_fonts[m];s[m+"_font-family"]=o["font-family"]&&o["font-family"]!="inherit"?'font-family:"'+o["font-family"]+'";':"";s[m+"_font-size"]=o["font-size"]&&o["font-size"]!="inherit"?"font-size:"+k(o["font-size"])+";":"";s[m+"_line-height"]=o["line-height"]&&o["line-height"]!="inherit"?"line-height:"+k(o["line-height"])+";":"";s[m+"_line-height_value"]=o["line-height"]?k(o["line-height"]):"inherit";s[m+"_font-weight"]=o["font-weight"]&&o["font-weight"]!="inherit"?"font-weight:"+o["font-weight"]+";":"";s[m+"_font-style"]=o["font-style"]&&o["font-style"]!="inherit"&&o["font-style"].indexOf("i")>=0?"font-style:italic;":"";s[m+"_text-decoration"]=o["font-style"]&&o["font-style"]!="inherit"&&o["font-style"].indexOf("u")>=0?"text-decoration:underline;":"";s[m+"_margin-top"]=o["margin-top"]&&o["margin-top"]!="inherit"?"margin-top:"+k(o["margin-top"])+";":"";s[m+"_margin-top_value"]=o["margin-top"]?k(o["margin-top"]):"inherit";s[m+"_margin-bottom"]=o["margin-bottom"]&&o["margin-bottom"]!="inherit"?"margin-bottom:"+k(o["margin-bottom"])+";":"";s[m+"_margin-bottom_value"]=o["margin-bottom"]?k(o["margin-bottom"]):"inherit"}if(window.melodyschool_customizer_wp_add_theme_fonts){s=melodyschool_customizer_wp_add_theme_fonts(s)}r+=j.fonts(s);h.previewer.send("refresh-customizer-css",r)}function k(m){if(m!=""&&m!="inherit"){var i=m.substr(-1);if("0"<=i&&i<="9"){m+="px"}}return m}})(wp.customize);